/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.0.8'
    id 'org.beryx.runtime' version '1.8.0'

    // TODO no good alternative to maven duplicate finder
    // id "net.idlestate.gradle-duplicate-classes-check" version "1.0.2"

    // TODO add equivalent of maven dependency plugin
    // TODO until https://github.com/wfhartford/gradle-dependency-analyze/issues/39 is done, this plugin is useless
//    id "ca.cutterslade.analyze" version "1.3.3"
}

group = 'net.yudichev'
version = '1.0-SNAPSHOT'
//noinspection GroovyUnusedAssignment
sourceCompatibility = '13'

application {
    mainClassName = 'net.yudichev.googlephotosupload.ui.Launcher'
    applicationName = 'Google Photos Uploader'
}

dependencies {
    ext.orgJunitJupiterVersion = '5.5.0'
    ext.orgMockitoVersion = '2.28.2'
    ext.orgImmutablesVersion = '2.8.3'

    annotationProcessor "org.immutables:value:$orgImmutablesVersion"
    testAnnotationProcessor "org.immutables:value:$orgImmutablesVersion"

    implementation platform("net.yudichev.jiotty:jiotty-bom:1.2.1-SNAPSHOT")
    implementation platform("com.google.inject:guice-bom:4.2.2")

    // This is needed as we depend on no_aop guice instead (regular Guice does not work on Java 13)
    def withoutGuice = {
        exclude group: "com.google.inject", module: "guice"
    }

    implementation "net.yudichev.jiotty:jiotty-common", withoutGuice
    implementation "net.yudichev.jiotty:jiotty-connector-google-photos", withoutGuice
    implementation "com.google.inject.extensions:guice-assistedinject", withoutGuice
    implementation "org.slf4j:slf4j-api"
    implementation "org.apache.logging.log4j:log4j-api"
    implementation "com.google.inject:guice::no_aop"
    implementation "javax.inject:javax.inject"
    implementation "com.google.guava:guava"
    implementation "com.google.code.findbugs:jsr305"
    implementation "com.google.errorprone:error_prone_annotations"
    implementation "com.fasterxml.jackson.core:jackson-annotations"
    implementation "com.google.api:gax"
    implementation "com.google.api:gax-grpc"
    implementation "com.google.http-client:google-http-client"
    implementation "io.grpc:grpc-api"
    implementation "commons-cli:commons-cli:1.4"
    implementation "com.fasterxml.jackson.core:jackson-databind:2.9.9"
    implementation "de.codecentric.centerdevice:centerdevice-nsmenufx:2.1.6"

    // This is to test dependency analyser
    //implementation "org.apache.commons:commons-skin:4.2"
    compileOnly "org.immutables:value:$orgImmutablesVersion"
    runtimeOnly "org.apache.logging.log4j:log4j-slf4j-impl:2.12.1"
    runtimeOnly "org.apache.logging.log4j:log4j-jcl:2.12.1"
    runtimeOnly "com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.9.9"
    runtimeOnly "com.lmax:disruptor:3.4.2"

    testImplementation "net.yudichev.jiotty:jiotty-common"
    testImplementation "org.junit.jupiter:junit-jupiter-api:$orgJunitJupiterVersion"
    testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:$orgJunitJupiterVersion"
    testImplementation "org.mockito:mockito-core:$orgMockitoVersion"
    testImplementation "org.mockito:mockito-junit-jupiter:$orgMockitoVersion"
    testImplementation "org.hamcrest:hamcrest:2.1"
    testImplementation "com.spotify:hamcrest-optional:1.1.4"
    testCompileOnly "org.immutables:value:$orgImmutablesVersion"
}

repositories {
    mavenCentral()
    mavenLocal()
}

javafx {
    version = '13.0.1'
    modules = ['javafx.controls', 'javafx.fxml', 'javafx.web']
}

test {
    useJUnitPlatform()
}

runtime {
    //noinspection GroovyAssignabilityCheck
    options = ['--strip-debug',
               '--compress', '2',
               '--no-header-files',
               '--no-man-pages']
    jpackage {
        jpackageHome = '/Library/Java/JavaVirtualMachines/jdk-14.jdk/Contents/Home'
        jvmArgs = ['-Dprism.verbose=true']
        if (org.gradle.internal.os.OperatingSystem.current().macOsX) {
            installerType = 'dmg'
        }
        if (org.gradle.internal.os.OperatingSystem.current().windows) {
            installerType = 'exe'
            installerOptions = ['--win-per-user-install', '--win-menu']
        }
    }
}